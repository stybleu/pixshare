{% extends "base.html" %}
{% set title = "DirectFile" %}
{% block content %}

<style>
  /* Scope : √©vite d‚Äôimpacter toute la page */
  .df *{
    font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
  }
  .df .btn, .df .form-control{
    border-radius: 12px;
  }
</style>

<div class="df">

  <!-- Header responsive -->
  <div class="d-flex flex-wrap gap-2 align-items-center justify-content-between mb-3">
    <div>
      <h1 class="h4 mb-0">üìÅ Pixshare</h1>
      <div class="text-muted small">Hebergeur d'image sans compte.</div>
    </div>

    <div class="d-flex gap-2">
      {% if admin %}
        <a class="btn btn-sm btn-outline-dark" href="{{ url_for('admin_panel') }}">Admin</a>
      {% else %}
        <a class="btn btn-sm btn-outline-primary" href="{{ url_for('admin_login') }}">Connexion</a>
      {% endif %}
    </div>
  </div>

  <!-- ‚úÖ Grille responsive : 1 colonne mobile / 2 colonnes PC -->
  <div class="row g-3 align-items-start">

    <!-- Upload -->
    <div class="col-12 col-lg-5">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h2 class="h6">Uploader un fichier (1 seul actif)</h2>
          <p class="text-muted small mb-3">
            Taille max : {{ max_mb }} Mo.
            En envoyant un fichier, tu acceptes les <a href="{{ url_for('cgu') }}">CGU</a>.
          </p>

          <form method="POST" enctype="multipart/form-data" class="row g-2 align-items-end">
            <div class="col-12">
              <label class="form-label">Choisir un fichier</label>
              <input class="form-control" type="file" name="file" required>
            </div>

            <!-- ‚úÖ Sur mobile le bouton prend toute la largeur -->
            <div class="col-12">
              <button class="btn btn-primary w-100" type="submit">Uploader</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Ton fichier -->
    <div class="col-12 col-lg-7">
      <div class="card shadow-sm h-100">
        <div class="card-body">

          <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
            <h2 class="h6 mb-0">Ton fichier</h2>
            {% if guest_file %}
              <span class="badge text-bg-success">Actif</span>
            {% else %}
              <span class="badge text-bg-secondary">Aucun</span>
            {% endif %}
          </div>

          <hr class="my-3">

          {% if guest_file %}
            <div class="mb-2">
              <div class="fw-semibold">{{ guest_file.original }}</div>
              <div class="text-muted small">{{ guest_file.size_h }} ‚Äî {{ guest_file.mtime_h }}</div>
            </div>

            <div class="d-flex flex-wrap gap-2 mb-3">
              {% if guest_file.previewable %}
                <a class="btn btn-success btn-sm" href="{{ guest_file.view_url }}" target="_blank" rel="noopener">Ouvrir</a>
              {% endif %}
              <a class="btn btn-primary btn-sm" href="{{ guest_file.download_url }}">T√©l√©charger</a>
            </div>

            <div class="text-muted small mb-1">Lien public √† partager :</div>

            <!-- ‚úÖ Input + bouton responsive -->
            <div class="input-group">
              <input
                id="publicLink"
                class="form-control"
                value="{{ guest_file.view_url }}"
                readonly
                onclick="this.select()"
              >
              <button type="button" class="btn btn-outline-primary" onclick="copyLink(event)">
                Copier
              </button>
            </div>

            <div class="text-muted small mt-2">Lien public.</div>
          {% else %}
            <p class="text-muted mb-0">
              Aucun fichier. Choisissez-en puis cliquez sur <b>Uploader</b>.
            </p>
          {% endif %}

        </div>
      </div>
    </div>

  </div>
</div>

<script>
  function copyLink(e){
    e.preventDefault();
    const input = document.getElementById("publicLink");
    if(!input) return;
    input.focus();
    input.select();
    input.setSelectionRange(0, 999999);
    (navigator.clipboard?.writeText(input.value) || Promise.reject())
      .catch(() => document.execCommand("copy"));
  }
</script>

{% endblock %}